server {
    listen 80;
    
    # Where your dist folder contents are copied
    # Senin dist klasörünün içeriğinin kopyalandığı yer
    root /usr/share/nginx/html;
    
    index index.html;

    # Load necessary MIME types (for CSS and JS to work correctly)
    # Gerekli MIME tiplerini yükle (CSS ve JS'in düzgün çalışması için)
    include /etc/nginx/mime.types;

    # Main Routing Rule (SPA Magic)
    # Ana Yönlendirme Kuralı (SPA Magic)
    location / {
        # 1. Is the requested file there? (e.g. /assets/index-....js)
        # 1. İstenen dosya var mı? (örn: /assets/index-....js)
        # 2. Is the directory there?
        # 2. Klasör var mı?
        # 3. If not, open index.html (Let React Router v7 handle it)
        # 3. Yoksa index.html'i aç (React Router v7 devreye girsin)
        try_files $uri $uri/ /index.html;
    }

    # Proxy to Backend API
    # Backend API'ye Yönlendirme
    # Requests starting with /api/v1 are forwarded to the backend container
    # /api/v1 ile başlayan istekler backend container'ına yönlendirilir
    location /api {
        proxy_pass http://backend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Proxy for Auth routes (Login etc.) - They are at root level /auth
    # Auth rotaları için yönlendirme (Login vb.) - Kök dizinde /auth altındalar
    location /auth {
        proxy_pass http://backend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
    
    # Proxy for Health check
    # Sağlık durumu kontrolü için yönlendirme
    location /health {
        proxy_pass http://backend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Proxy to Static Uploads
    # Statik Dosyalara Yönlendirme
    location /uploads {
        proxy_pass http://backend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # Cache Settings (Optional but recommended)
    # Cache Ayarları (Opsiyonel ama önerilir)
    # Files in assets folder are hashed (names change) so they can be cached for a long time.
    # Assets klasöründeki dosyalar hash'lendiği için (isimleri değişiyor) uzun süre cache'lenebilir.
    location /assets/ {
        expires 1y;
        add_header Cache-Control "public, immutable";
    }
}
